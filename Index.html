<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Makes the page scale properly on phones/tablets -->
  <meta name="viewport" content="width=device-width, initial-scale=1"/> 
  <title>QCAA Word Cutter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!--the actual style of the program !--> 
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --border:#d1d5db;
      --muted:#6b7280;
      --text:#111827;
      --brand:#2563eb;
      --ok:#2563eb;

      --shadow: 0 10px 28px rgba(0,0,0,.08);
      --shadow-soft: 0 6px 18px rgba(0,0,0,.06);

      --radius: 14px;
      --radius-sm: 10px;
    }

    *{ box-sizing:border-box; font-family:Inter, system-ui, -apple-system, Segoe UI, sans-serif; }

    body{
      margin:0;
      background: linear-gradient(180deg, #f7f7fb 0%, var(--bg) 45%);
      color:var(--text);
      padding:22px 14px;
    }

    .wrap{
      max-width: 1040px;
      margin: 0 auto;
      background: var(--card);
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }

    header{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
      margin-bottom: 16px;
    }

    h1{
      margin:0;
      font-size: 1.7rem;
      font-weight: 750;
      letter-spacing: -0.02em;
    }

    .sub{
      margin:0;
      color:var(--muted);
      font-size:.95rem;
      line-height: 1.35;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 16px;
      align-items:start;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .section-title{
      font-size:.97rem;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:var(--muted);
      margin: 0 0 10px;
      font-weight: 700;
    }

    textarea{
      width:100%;
      min-height: 454px;
      padding: 12px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: .95rem;
      line-height: 1.5;
      resize: vertical;
      outline: none;
      background: #fbfbfd;
      box-shadow: inset 0 1px 0 rgba(17,24,39,.03);
    }

    textarea:focus{
      border-color: var(--brand);
      background:#fff;
      box-shadow: 0 0 0 3px rgba(37,99,235,.14);
    }

    textarea::placeholder{ color:#9ca3af; }

    .box{
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px;
      background: #fafafa;
      box-shadow: var(--shadow-soft);
    }

    .checks{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    /* Two columns on wider screens for a cleaner look */
    @media (min-width: 980px){
      .checks{ grid-template-columns: 1fr 1fr; }
    }

    .checks label{
      display:flex;
      gap:10px;
      align-items:flex-start;
      cursor:pointer;
      font-size: .94rem;
      color:#374151;
      user-select:none;
      line-height: 1.25;
      padding: 6px 8px;
      border-radius: 10px;
      transition: background .12s ease;
    }

    .checks label:hover{
      background: rgba(37,99,235,.06);
    }

    .checks input[type="checkbox"]{
      margin-top: 2px;
      width: 16px;
      height: 16px;
      accent-color: var(--brand);
      flex: 0 0 auto;
    }

    .btn-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
      margin-bottom: 12px;
    }

    button{
      border: 1px solid transparent;
      border-radius: 12px;
      padding: 10px 13px;
      font-weight: 700;
      font-size: .92rem;
      cursor:pointer;
      background: var(--brand);
      color:#fff;
      transition: transform .06s ease, box-shadow .12s ease, background .12s ease, filter .12s ease;
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
    }

    button:hover{
      filter: brightness(1.03);
      box-shadow: 0 14px 24px rgba(37,99,235,.22);
    }

    button:active{
      transform: translateY(1px);
      box-shadow: 0 8px 14px rgba(37,99,235,.18);
    }

    /* Copy button */
    #copyBtn{
      background: var(--ok);
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
    }

    /* Make copy button slightly “toolbar sized” */
    #copyBtn{
      padding: 9px 12px;
      border-radius: 12px;
    }

    .counts{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size: .92rem;
      margin-top: 6px;
    }

    .counts strong{ color: var(--text); }

    .out{
      margin-top: 18px;
    }

    /* Output header row: title left, copy right */
    .out-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;

      padding: 10px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #fafafa;
      box-shadow: var(--shadow-soft);
      margin-bottom: 10px;
    }

    .out-head .section-title{
      margin: 0;
    }

    .out-head .btn-row{
      margin: 0;
    }

    /* Output textarea: slightly different feel */
    #outputText{
      background:#ffffff;
      min-height: 520px;
    }

    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: .88rem;
      line-height: 1.35;
    }

    footer{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid #e5e7eb;
      color: var(--muted);
      font-size: .88rem;
    }

    a{ color: var(--brand); text-decoration: none; font-weight: 600; }
    a:hover{ text-decoration: underline; }

    .counts-row {
      gap: 14px; 
    }

  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y46HEYBECH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Y46HEYBECH');
  </script>
</head>

<!--The actual content-->
<body>
  <div class="wrap">
    <header>
      <h1>QCAA Exclusions Word Cutter</h1>
      <p class="sub">Approximate QCAA-style word-count cleanup for assignments</p>
    </header>

    <div class="grid">
      <div>
        <p class="section-title">Text in</p>
        <textarea id="inputText" placeholder="Paste your assignment text here..."></textarea>
      </div>

      <div>
        <p class="section-title">Exclude</p>
        <div class="box">
          <div class="checks">
            <label><input type="checkbox" id="excludeNumbers" checked>Numerical Digits</label>
            <label><input type="checkbox" id="excludeUnits" checked>Units/Variables</label>
            <label><input type="checkbox" id="excludeSymbols" checked>Symbols</label>
            <label><input type="checkbox" id="excludePageNumbers" checked>Page Numbers</label>
            <label><input type="checkbox" id="excludeCitations" checked>In-text citations</label>
            <label><input type="checkbox" id="excludeInlineFigureRefs">Inline figure references</label>
            <label><input type="checkbox" id="excludeFigureCaptions" checked>Captions</label>
            <label><input type="checkbox" id="excludeEquations" checked>Equations</label>
            <label><input type="checkbox" id="excludeTitle" checked>Title</label>
            <label><input type="checkbox" id="excludeContents" checked>Contents list section</label>
            <label><input type="checkbox" id="excludeAbstract" checked>Abstract section content</label>
            <label><input type="checkbox" id="excludeReferences" checked>Reference List / Bibliography</label>
            <label><input type="checkbox" id="excludeAppendices" checked>Appendices</label>
            <label><input type="checkbox" id="excludeQuotes">Text inside quotations</label>
          </div>

          <div class="btn-row counts-row">
            <button id="processBtn" type="button">Process</button>

            <div class="counts">
              <span>Original: <strong id="originalCount">0</strong> words</span>
              <span>Filtered: <strong id="filteredCount">0</strong> words</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Output area -->
    <div class="out">
      <!-- NEW: heading + copy button on the same row -->
      <div class="out-head">
        <p class="section-title">Text out</p>

        <!-- Copy button copies output to clipboard -->
        <div class="btn-row">
          <button id="copyBtn" type="button">Copy cleaned text</button>
        </div>
      </div>

      <!-- Result appears here but its readonly so users don’t accidentally edit it) -->
      <textarea id="outputText" readonly placeholder="Your cleaned assignment text will appear here..."></textarea>

      <!-- Disclaimer -->
      <div class="note">Note: this is an approximation. Do a quick manual check before you submit.</div>
    </div>

    <!-- Footer -->
    <footer>
      <div>
        <a href="https://www.qcaa.qld.edu.au/senior/certificates-and-qualifications/qce-qcia-handbook/8-school-assessment-policies/8.2-integrating-learning-assessment"
           target="_blank" rel="noopener noreferrer">
          QCAA exclusions rules
        </a>
      </div>
      <div>This is a local tool — nothing gets uploaded. (Created by Timothy Zhu) </div>
    </footer>
  </div>

  <!---Background processes-->
  <script>
    function $(id) { return document.getElementById(id); }

    // Reads checkbox state by id
    function isChecked(id) { return $(id).checked; }

    //word counting
    function countWords(text) {
      // If null/empty, return 0 quickly
      if (!text) return 0;

      // Trim ends, split on one-or-more whitespace, count real tokens
      var tokens = text.trim().split(/\s+/);
      return tokens.filter(Boolean).length;
    }
    // Line-level detectors (used while scanning the input line by line)

    // Matches caption lines
    function isFigureCaptionLine(line) {
      return /^(figure|fig\.|table|diagram)\s*\d*\s*:/i.test(line);
    }

    // Matches common page number formats:
    function isPageNumberLine(line) {
      if (/^page\s*\d+(\s*of\s*\d+)?$/i.test(line)) return true;
      if (/^\d+$/.test(line)) return true;
      if (/^\d+\/\d+$/.test(line)) return true;
      if (/^[-\s]*\d+[-\s]*$/.test(line)) return true;
      return false;
    }

    // Rough approximation: if there's "=" and it’s short enough, treat as an equation line
    function looksLikeShortEquation(line) {
      if (!/=/.test(line)) return false;

      var lengthOk = line.length <= 80; // short character length
      var wordsOk  = line.split(/\s+/).filter(Boolean).length <= 10; // or short word count

      // If either test passes, we call it equation-ish
      return lengthOk || wordsOk;
    }

    // Removes inline references inside running text:
    function removeInlineFigureRefs(text) {
      return text.replace(/\b(Figure|Fig\.|Table)\s*\d+\b/g, " ");
    }

    // Section heading detection (References / Appendix / Abstract / Contents)

    // Returns a short key if a line looks like a section heading, otherwise null
    function getSectionHeading(trimmed) {
      // Note: allows optional numbering like "8.2 References"
      if (/^\s*(?:\d+(?:\.\d+)*)?\s*(references|reference\s+list|bibliography)\s*$/i.test(trimmed)) return "ref";
      if (/^\s*(?:\d+(?:\.\d+)*)?\s*(appendix|appendices)\s*$/i.test(trimmed)) return "app";
      if (/^\s*(?:\d+(?:\.\d+)*)?\s*abstract\s*$/i.test(trimmed)) return "abs";
      if (/^\s*(?:\d+(?:\.\d+)*)?\s*(contents|table\s+of\s+contents)\s*$/i.test(trimmed)) return "contents";
      return null;
    }

    // Units / variable token lists (used during token-level filtering)

    // Common units to drop
    var UNIT_TOKENS = new Set([
      "m","km","cm","mm","um","nm",
      "s","ms","min","h","hr",
      "kg","g","mg","ug","µg",
      "mol","mmol",
      "l","ml","kl",
      "n","kn",
      "j","kj",
      "w","kw",
      "v",
      "pa","kpa","mpa",
      "hz","khz","mhz",
      "ohm","ω",
      "c","k"
    ]);

    // Optional: treat single letters (b..z) as “variables” and remove them
    // (a is handled specially because “a” is a real word)
    var SINGLE_LETTERS = new Set("bcdefghijklmnopqrstuvwxyz".split(""));

    // Decide if a token should be dropped as a unit/variable
    function shouldDropUnitToken(token) {
      // Strip everything except letters and a couple of unit symbols (µ, ω)
      var clean = token.replace(/[^A-Za-zµω]/g, "");
      if (!clean) return false;

      var lower = clean.toLowerCase();

      // Keep the word "a" 
      if (lower === "a") return false;

      // Remove known units
      if (UNIT_TOKENS.has(lower)) return true;

      // Remove single-letter variables ONLY if it’s exactly one letter
      if (clean.length === 1 && SINGLE_LETTERS.has(lower)) return true;

      return false;
    }

    // Protect + restore "(Figure 1)" style refs before citation stripping (dont remove inline references to figures lol- idk why it was doing that)

    // Temporarily replace "(Figure 1)" with placeholders so citation regex doesn't remove them.
    function protectFigureRefs(text) {
      var placeholders = [];

      var out = text.replace(/\(\s*(Figure|Fig\.|Table)\s*\d+\s*\)/gi, function(match) {
        var key = "__FIGREF__" + placeholders.length + "__";
        placeholders.push({ key: key, value: match });
        return key;
      });

      // Return both the modified text and the placeholder map
      return { text: out, placeholders: placeholders };
    }

    // Put all the "(Figure 1)" placeholders back into the final text
    function restoreFigureRefs(text, placeholders) {
      for (var i = 0; i < placeholders.length; i++) {
        var ph = placeholders[i];
        text = text.replaceAll(ph.key, ph.value);
      }
      return text;
    }

    // Inline removals (citations, bracket equations, quotes)
    function stripCitations(text) {
      text = text.replace(/\(((?!\s*(Figure|Fig\.|Table)\b)[^)]*?\d{1,4}[^)]*?)\)/gi, " ");
      text = text.replace(/\(((?!\s*(Figure|Fig\.|Table)\b)[^)]*?n\.?\s*d\.?[^)]*?)\)/gi, " ");
      text = text.replace(/\[[^\]]*?\d+[^\]]*?\]/g, " ");
      return text;
    }

    // Removes equations that are inside brackets/parentheses
    function stripBracketEquations(text) {
      text = text.replace(/\(([^)]*=[^)]*?)\)/g, " ");
      text = text.replace(/\[([^]]*=[^]]*?)\]/g, " ");
      return text;
    }

    // Removes single-line quoted text: 
    function stripInlineQuotes(text) {
      text = text.replace(/"[^"\n]*"/g, " ");
      text = text.replace(/'[^'\n]*'/g, " ");
      return text;
    }

    // Final cleanup: squash extra spaces/newlines
    function tidy(text) {
      text = text.replace(/[ \t]+/g, " ");  // multiple spaces/tabs -> one space
      text = text.replace(/ \n/g, "\n");    // space before newline -> remove
      text = text.replace(/\n{3,}/g, "\n\n"); // 3+ blank lines -> 2
      text = text.replace(/^\s+|\s+$/g, "");  // trim start/end
      return text;
    }

    // Main processing 
    function processText() {
      // Read input and update original word count
      var raw = $("inputText").value || "";
      $("originalCount").textContent = countWords(raw);

      // Split input into lines so we can remove whole lines (captions/page numbers/etc)
      var lines = raw.split(/\r?\n/);

      // If title removal is enabled, blank out the first line (because we think this is the title)
      if (isChecked("excludeTitle") && lines.length) {
        lines[0] = "";
      }

      // Collect lines that survive the line-based filters
      var outLines = [];

      // Tracks whether we are currently inside a section (ref/app/abs/contents)
      var section = null;

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        var trimmed = line.trim();

        // If the line looks like a section heading, update the section state
        var heading = getSectionHeading(trimmed);
        if (heading) {
          section = heading;

          // Decide if this whole section should be excluded
          var excluded =
            (section === "ref" && isChecked("excludeReferences")) ||
            (section === "app" && isChecked("excludeAppendices")) ||
            (section === "abs" && isChecked("excludeAbstract")) ||
            (section === "contents" && isChecked("excludeContents"));

          // Only keep the heading line if the section is not excluded
          if (!excluded) outLines.push(line);
          continue;
        }

        // Contents section special case:
        // Many contents pages end at a blank line, so we stop skipping when we hit one.
        if (section === "contents" && isChecked("excludeContents")) {
          if (trimmed === "") {
            section = null;       // exit contents mode
            outLines.push(line);  // keep the blank line as a separator
          }
          continue; // skip everything else while in contents
        }

        // Skip entire section bodies if that section is excluded
        if (section === "ref" && isChecked("excludeReferences")) continue;
        if (section === "app" && isChecked("excludeAppendices")) continue;
        if (section === "abs" && isChecked("excludeAbstract")) continue;

        // Per-line filters
        if (isChecked("excludePageNumbers") && isPageNumberLine(trimmed)) continue;
        if (isChecked("excludeFigureCaptions") && isFigureCaptionLine(trimmed)) continue;
        if (isChecked("excludeEquations") && looksLikeShortEquation(trimmed)) continue;

        // If we didn’t skip it, keep the line
        outLines.push(line);
      }

      // Convert surviving lines back into one text blob
      var text = outLines.join("\n");

      // Protect "(Figure 1)" etc so previous removals dont remove them
      var protectedPack = protectFigureRefs(text);
      text = protectedPack.text;

      // Inline filters (string-wide)
      if (isChecked("excludeCitations")) text = stripCitations(text);
      if (isChecked("excludeEquations")) text = stripBracketEquations(text);
      if (isChecked("excludeInlineFigureRefs")) text = removeInlineFigureRefs(text);
      if (isChecked("excludeQuotes")) text = stripInlineQuotes(text);

      // Token-ish pass:
      // Split by whitespace but keep the whitespace tokens (so spacing stays natural)
      var parts = text.split(/(\s+)/);
      var finalParts = [];

      for (var p = 0; p < parts.length; p++) {
        var t = parts[p];

        // If it’s pure whitespace, keep it as-is
        if (/^\s+$/.test(t)) { finalParts.push(t); continue; }

        // Unit/variable removal
        if (isChecked("excludeUnits") && shouldDropUnitToken(t)) continue;

        // Remove anything containing digits if enabled (e.g., "2020", "H2O", "2nd")
        if (isChecked("excludeNumbers") && /\d/.test(t)) continue;

        // Remove tokens with no letters (punctuation-only chunks)
        if (isChecked("excludeSymbols") && !/[A-Za-z]/.test(t)) continue;

        // Otherwise keep token
        finalParts.push(t);
      }

      // Rebuild final string
      var cleaned = finalParts.join("");

      // Restore protected "(Figure 1)" placeholders
      cleaned = restoreFigureRefs(cleaned, protectedPack.placeholders);

      // Final spacing cleanup
      cleaned = tidy(cleaned);

      // Write output and update filtered word count
      $("outputText").value = cleaned;
      $("filteredCount").textContent = countWords(cleaned);
    }

    // Debounce helper (prevents running processText too often on large pastes)
    function debounce(fn, ms) {
      var t;
      return function () {
        clearTimeout(t);
        t = setTimeout(fn, ms);
      };
    }

    // Wire up UI once the page loads
    window.onload = function () {
      // Manual process button
      $("processBtn").onclick = processText;

      // Auto-process while typing/pasting (debounced so it’s smoother)
      $("inputText").oninput  = debounce(processText, 60);

      // Copy output text to clipboard
      $("copyBtn").onclick = function () {
        var txt = $("outputText").value || "";
        if (!txt) return;

        // Modern clipboard API if available
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(txt).then(function () {
            // Quick feedback so user knows it copied
            var btn = $("copyBtn");
            var old = btn.textContent;
            btn.textContent = "Copied!";
            setTimeout(function () { btn.textContent = old; }, 900);
          });
        } else {
          // Fallback: select the output so user can Ctrl+C manually
          $("outputText").focus();
          $("outputText").select();
        }
      };

      // Run once on load so counts/output start in a clean state
      processText();
    };
  </script>
</body>
</html>
